---
title: 'What we can learn from Seattleâ€™s bike-counter data: TidyTuesday Apr 02 2019'
author: Aditya Mangal
date: '2019-04-13'
slug: what-we-can-learn-from-seattle-s-bike-counter-data-tidytuesday-apr-02-2019
categories:
  - TidyTuesday
tags:
  - DataAnalysis
  - DataScience
  - TidyTuesday
  - Visualizations
  - Transportation
summary: "While millions of public dollars are going for bike lanes in Seattle, the city's data collection on actual bike-lane ridership is scattered and incomplete. Given they're the best the public can get, here's what those numbers can tell us about who's riding where."
readingtime: "10"
draft: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,error = FALSE)
```


## Introduction

From the article on [Seattle Times](https://www.seattletimes.com/seattle-news/transportation/what-we-can-learn-from-seattles-bike-counter-data/) - 

"While millions of public dollars are going for bike lanes in Seattle, the city's data collection on actual bike-lane ridership is scattered and incomplete. Given they're the best the public can get, here's what those numbers can tell us about who's riding where."

## Analysis  

Following along the [screencast](https://www.youtube.com/watch?v=sBho2GJE5lc) from [David Robinson](https://twitter.com/drob)

```{r}
library(tidyverse)
library(lubridate)
library(scales)
theme_set(theme_light())
```


```{r}
bike_traffic_raw <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-04-02/bike_traffic.csv", col_types = cols(bike_count = col_double(), ped_count = col_logical()))

bike_traffic <- bike_traffic_raw %>% 
  mutate(date = mdy_hms(date))

bike_traffic
```

```{r}
bike_traffic %>% 
  count(crossing, direction)
```

```{r}
bike_traffic %>% 
  ggplot(aes(date, fill = is.na(ped_count))) + 
  geom_histogram() +
  facet_wrap(~ crossing)
```

```{r}
bike_traffic %>% 
  ggplot(aes(date, fill = is.na(ped_count))) + 
  geom_histogram() +
  facet_grid(crossing ~ direction)
```

```{r}
bike_traffic %>% 
  ggplot(aes(date, fill = is.na(ped_count))) + 
  geom_histogram() +
  facet_grid(crossing ~ direction)
```

### When in the day do we see bikers?

```{r}
bike_traffic %>% 
  group_by(hour = hour(date)) %>% 
  summarise_at(vars(bike_count, ped_count), sum, na.rm = TRUE) %>% 
  ggplot(aes(hour, bike_count)) + 
  geom_line() + 
  geom_point()
```

```{r}
bike_traffic %>% 
  group_by(hour = hour(date),
           crossing) %>% 
  summarise_at(vars(bike_count, ped_count), sum, na.rm = TRUE) %>% 
  ggplot(aes(hour, bike_count, color = crossing)) + 
  geom_line() + 
  geom_point()
```

```{r}
bike_traffic %>% 
  group_by(crossing,
           hour = hour(date)) %>% 
  summarise_at(vars(bike_count, ped_count), sum, na.rm = TRUE) %>% 
  mutate(pct_bike = bike_count/sum(bike_count)) %>% 
  ggplot(aes(hour, pct_bike, color = crossing)) + 
  geom_line() + 
  geom_point() + 
  scale_y_continuous(labels = percent_format()) +
  labs(title = "When in the day do people bike through these Seattle crossings?",
       subtitle = "Based on crossings from 2014-2017",
       color = "Crossing",
       x = "Time of day (local time)",
       y = "% of bike crossings that happen in this hour")
```

```{r}
bike_traffic %>% 
  mutate(hour = hour(date), 
         time_window = case_when(
           between(hour, 7, 10) ~ "Morning Commute",
           between(hour, 11, 15) ~ "Midday",
           between(hour, 16, 18) ~ "Evening Commute",
           TRUE ~ "Night"
         )) %>% 
  group_by(crossing, 
           time_window) %>% 
  summarise(number_missing = sum(is.na(bike_count)),
            bike_count = sum(bike_count, na.rm = TRUE)) %>% 
  mutate(pct_bike = bike_count/sum(bike_count)) -> bike_by_time_window

bike_by_time_window %>% 
  select(-number_missing, -bike_count) %>% 
  spread(time_window, pct_bike) %>% 
  mutate(TotalCommute = `Evening Commute` + `Morning Commute`) %>% 
  arrange(desc(TotalCommute))
```

```{r}
bike_by_time_window %>% 
  ggplot(aes(time_window, pct_bike)) + 
  geom_col() + 
  coord_flip() +
  facet_wrap(~ crossing)
```

```{r}
bike_by_time_window %>% 
  group_by(crossing) %>% 
  summarise(total_bikes = sum(bike_count),
            pct_commute = sum(bike_count[str_detect(time_window, "Commute")]) / total_bikes) %>% 
  ggplot(aes(total_bikes, pct_commute)) + 
  geom_point() + 
  scale_x_log10()
```


